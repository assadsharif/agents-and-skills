# SDD Toolkit (.specify/)

**Spec-Driven Development Infrastructure** - Core templates, scripts, and governance for the SDD methodology.

## Overview

The `.specify/` directory contains the foundational components of the SDD toolkit:

- **Constitution** - Project governance and development principles
- **Templates** - Structured formats for specs, plans, tasks, ADRs, and PHRs
- **Scripts** - Automation for SDD workflow operations

## Directory Structure

```
.specify/
├── memory/
│   └── constitution.md          # Project governance and principles
├── scripts/
│   └── bash/                    # SDD workflow automation
│       ├── common.sh            # Shared functions library
│       ├── check-prerequisites.sh
│       ├── create-adr.sh
│       ├── create-new-feature.sh
│       ├── create-phr.sh
│       ├── setup-plan.sh
│       └── update-agent-context.sh
└── templates/                   # Document templates
    ├── adr-template.md          # Architecture Decision Record
    ├── agent-file-template.md   # Agent context file
    ├── checklist-template.md    # Custom validation checklist
    ├── phr-template.prompt.md   # Prompt History Record
    ├── plan-template.md         # Implementation plan
    ├── spec-template.md         # Feature specification
    └── tasks-template.md        # Task breakdown
```

---

## Constitution

**Location:** `memory/constitution.md`

The project constitution defines non-negotiable principles:

### Core Principles

1. **Spec-Driven Development** - Every feature starts with a spec
2. **Test-First (TDD)** - Red-Green-Refactor cycle strictly enforced
3. **Smallest Viable Diff** - Minimum necessary changes only
4. **Traceability** - Full chain from spec → plan → tasks → commits
5. **Security by Default** - No hardcoded secrets, .env protection
6. **Simplicity (YAGNI)** - Don't design for hypothetical futures

### Quality Gates

- ✅ All specs have measurable acceptance criteria
- ✅ All plans reference their spec
- ✅ All tasks independently testable
- ✅ All code passes tests before merge
- ✅ Constitution violations are CRITICAL

**Version:** 1.0.0
**Ratified:** 2026-02-17

---

## Templates

### spec-template.md

**Purpose:** Feature specification format
**Usage:** Automatically applied by `/sp.specify` agent

**Sections:**
- Overview - What problem does this solve?
- Functional Requirements - What must the feature do?
- Non-Functional Requirements - Performance, security, UX
- User Stories - Concrete user interactions
- Acceptance Criteria - Measurable success conditions
- Out of Scope - What this feature does NOT include

### plan-template.md

**Purpose:** Technical implementation planning
**Usage:** Automatically applied by `/sp.plan` agent

**Sections:**
- Architecture Overview - High-level design
- Technology Stack - Frameworks, libraries, tools
- Data Model - Entities, relationships, schemas
- API Contracts - Endpoints, inputs, outputs
- Implementation Phases - Ordered build sequence
- Dependencies - External systems, services
- Testing Strategy - Unit, integration, e2e approach
- Risk Assessment - Known risks and mitigations

### tasks-template.md

**Purpose:** Ordered, testable task breakdown
**Usage:** Automatically applied by `/sp.tasks` agent

**Sections:**
- Phase breakdown by user story
- Task IDs with [P] parallel markers
- File paths and test cases
- Dependencies and ordering
- Acceptance criteria per task

### adr-template.md

**Purpose:** Architecture Decision Record
**Usage:** Invoked by `/sp.adr <title>` command

**Sections:**
- Status (Proposed, Accepted, Superseded)
- Context - What forces led to this decision?
- Decision - What was chosen and why?
- Consequences - Positive and negative impacts
- Alternatives Considered - What was rejected and why?

### phr-template.prompt.md

**Purpose:** Prompt History Record
**Usage:** Automatically created after significant work

**Metadata:**
- ID, Title, Stage, Date
- Model, Feature, Branch, User
- Command, Labels, Links (Spec, Ticket, ADR, PR)
- Files modified, Tests run

**Content:**
- Full user prompt (verbatim)
- Assistant response (concise)
- Outcome and evaluation notes

### checklist-template.md

**Purpose:** Domain-specific validation checklists
**Usage:** Generated by `/sp.checklist` for specialized validation

### agent-file-template.md

**Purpose:** Agent context file for multi-stage features
**Usage:** Created by agents to maintain context across sessions

---

## Scripts

All scripts located in `scripts/bash/` are executable and syntax-validated.

### common.sh

**Purpose:** Shared utility functions
**Dependencies:** None

**Key Functions:**
- `log_info`, `log_error`, `log_success` - Colored output
- `check_git_repo` - Verify git repository
- `get_feature_from_branch` - Extract feature name from branch
- `ensure_directory` - Create directory if missing
- File validation helpers

**Usage:**
```bash
source .specify/scripts/bash/common.sh
log_info "Starting process..."
```

### check-prerequisites.sh

**Purpose:** Validate SDD workflow prerequisites
**Usage:** `bash check-prerequisites.sh [--json] [--require-tasks]`

**Checks:**
- Git repository status
- Feature branch naming (001-feature-name)
- Spec/plan/tasks file existence
- File content validation

**Output:**
```json
{
  "success": true,
  "feature_name": "user-authentication",
  "feature_dir": "specs/user-authentication",
  "available_docs": ["spec", "plan", "tasks"]
}
```

### create-new-feature.sh

**Purpose:** Scaffold new feature with SDD structure
**Usage:** `bash create-new-feature.sh "Feature Name"`

**Creates:**
- Feature branch (001-feature-name)
- Feature directory (specs/feature-name/)
- Empty spec.md, plan.md, tasks.md placeholders

**Example:**
```bash
bash .specify/scripts/bash/create-new-feature.sh "User Authentication"
# Creates: branch 001-user-authentication
# Creates: specs/user-authentication/spec.md
```

### create-adr.sh

**Purpose:** Create Architecture Decision Record
**Usage:** `bash create-adr.sh "Decision Title" [--json]`

**Creates:**
- Sequential ADR in history/adr/
- Numbered format: 0001-decision-title.md
- Pre-filled template with metadata

**Example:**
```bash
bash .specify/scripts/bash/create-adr.sh "Use PostgreSQL for primary database"
# Creates: history/adr/0001-use-postgresql.md
```

### create-phr.sh

**Purpose:** Create Prompt History Record
**Usage:** `bash create-phr.sh --title "Title" --stage <stage> [--feature <name>] [--json]`

**Stages:**
- constitution, spec, plan, tasks
- red, green, refactor (TDD)
- explainer, misc, general

**Routes:**
- constitution → history/prompts/constitution/
- Feature stages → history/prompts/<feature-name>/
- general → history/prompts/general/

**Example:**
```bash
bash .specify/scripts/bash/create-phr.sh \
  --title "implement-user-login" \
  --stage green \
  --feature user-authentication \
  --json
# Creates: history/prompts/user-authentication/0042-implement-user-login.green.prompt.md
```

### setup-plan.sh

**Purpose:** Initialize plan.md from template
**Usage:** `bash setup-plan.sh <feature-dir>`

**Actions:**
- Copies plan-template.md to feature directory
- Initializes metadata placeholders
- Links to spec.md

### update-agent-context.sh

**Purpose:** Update agent context files during multi-stage work
**Usage:** `bash update-agent-context.sh <feature-dir> <stage>`

**Updates:**
- Current stage progress
- Completed milestones
- Next action items

---

## Usage Patterns

### Starting a New Feature

```bash
# 1. Create feature branch and structure
bash .specify/scripts/bash/create-new-feature.sh "User Authentication"

# 2. Switch to feature branch (done automatically by script)
git checkout 001-user-authentication

# 3. Use SDD workflow
# /sp.specify - Create spec from requirements
# /sp.plan - Generate implementation plan
# /sp.tasks - Break into testable tasks
# /sp.implement - Execute with TDD
```

### Recording Decisions

```bash
# During planning or architecture work
bash .specify/scripts/bash/create-adr.sh "Use JWT for authentication tokens"

# Fills template in: history/adr/0001-use-jwt.md
# Edit to add context, alternatives, consequences
```

### Capturing Work Sessions

```bash
# Automatically created by agents after significant work
# Manual creation if needed:
bash .specify/scripts/bash/create-phr.sh \
  --title "fix-login-validation-bug" \
  --stage green \
  --feature user-authentication
```

### Validating Before Implementation

```bash
# Check prerequisites before starting work
bash .specify/scripts/bash/check-prerequisites.sh --json --require-tasks

# Returns status and file locations
# Aborts if spec/plan/tasks missing
```

---

## Integration with Agents

The SDD agents (in `.claude/agents/`) use these scripts and templates:

| Agent | Uses Scripts | Uses Templates |
|-------|--------------|----------------|
| sdd-specify | check-prerequisites.sh | spec-template.md |
| sdd-plan | check-prerequisites.sh, setup-plan.sh | plan-template.md |
| sdd-tasks | check-prerequisites.sh | tasks-template.md |
| sdd-adr | create-adr.sh | adr-template.md |
| sdd-phr | create-phr.sh | phr-template.prompt.md |
| sdd-analyze | check-prerequisites.sh | - |
| sdd-checklist | - | checklist-template.md |

---

## Maintenance

### Adding New Templates

1. Create template in `.specify/templates/`
2. Use YAML frontmatter for metadata
3. Use `{{PLACEHOLDER}}` syntax for variables
4. Document in this README

### Adding New Scripts

1. Create script in `.specify/scripts/bash/`
2. Make executable: `chmod +x script.sh`
3. Source `common.sh` for utilities
4. Add `--json` output option
5. Document in this README
6. Test syntax: `bash -n script.sh`

### Updating Constitution

1. Edit `.specify/memory/constitution.md`
2. Update version number
3. Add to "Last Amended" date
4. Document rationale in commit message
5. Requires explicit user approval

---

## Best Practices

### Template Usage

- ✅ Use templates via agents, not manual copying
- ✅ Fill all placeholders before proceeding
- ✅ Keep templates concise and actionable
- ❌ Don't modify templates without version tracking

### Script Usage

- ✅ Always check exit codes ($?)
- ✅ Use --json flag for programmatic parsing
- ✅ Source common.sh for shared functions
- ❌ Don't bypass prerequisite checks

### Constitution Compliance

- ✅ Treat as non-negotiable within scope
- ✅ Constitution violations are CRITICAL
- ✅ Amendments require explicit approval
- ❌ Don't dilute or reinterpret principles

---

## Troubleshooting

### "Not on a feature branch" error

**Problem:** Scripts require feature branch (001-feature-name)
**Solution:** Run `create-new-feature.sh` or checkout feature branch

### "Missing spec.md" error

**Problem:** Prerequisite files not found
**Solution:** Run workflow in order: specify → plan → tasks

### Template placeholders not filled

**Problem:** Output contains {{PLACEHOLDER}}
**Solution:** Agents should fill these; manual editing required if present

### Script permission denied

**Problem:** Script not executable
**Solution:** `chmod +x .specify/scripts/bash/*.sh`

---

## Version History

- **1.0.0** (2026-02-17) - Initial toolkit release
  - 7 templates, 7 scripts
  - Constitution ratified
  - Full SDD workflow operational

---

## See Also

- [Project README](../README.md) - Quick Start and component overview
- [CLAUDE.md](../CLAUDE.md) - Runtime development guidelines
- [Constitution](memory/constitution.md) - Project governance
- [Example PHR](../history/prompts/general/0001-example-phr.general.prompt.md)
- [Example ADR](../history/adr/0001-example-decision.md)

---

**Maintained by:** SDD Toolkit Team
**Last Updated:** 2026-02-18
